---
title: RPARSER
description: A RADIUS parser written using C++ and PcapPlusPlus (wrapper for C-DPDK). It extracts attributes from the RADIUS layer.
date: 2021-06-11
image: ./data1.jpg
banner: ./data1.jpg
---

A RADIUS parser written using C++ and PcapPlusPlus (wrapper for C-DPDK). 
It extracts attributes from the RADIUS layer.




# High Level Overview

The program starts and 
- initializes the EAL params
- setups and starts dpdk devices (ports)
- Spawn workerThreads

Each workerThread
- receives a burst on the port
- loops through the packet burst
- for each packet burst 
    - checks packet type
    - checks for radius Accounting type
    - Parses header
    - Parser Attribute Value Pairs (AVPs)
    - writes to CSV
    - frees the packet
- receives the next burst and so on

![image](./CPacketParserArch.png)

---


# Extracted Information

The parser looks for following port numbers associate with authentication 
and authorization:

1. AUTHENTICATION PORT `1812` 
2. AUTHORIZATION PORT `1813`

The minimum lenght of Radius packet required is `230`


## Header
From the header following information is extracted

1. Radius Type
2. Message id
3. Radius Attribute Count

The CPacketParser parses message of the type `ACCOUNTING REQUEST` with is
identifiable by the code `4`.

## Extracted Attribute Value Pairs
The total number of attributes that are looked for are `4`. Following are
the attributes:

1. Framed IPv4 Address
    - Signifies the IPv4 address assigned to the user
2. Framed IPv6 Prefix
    - Signifies the IPv6 prefix assigned to the user
3. Calling Station ID
    - Signifies the calling station identity of the user 
    (either MSISDN, MAC or any other identifier)
4. Accounting Status Type
    - Start; indicating new connection and start of data flow
    - Stop; indicating termination connection and end of data flow
    - Update; indicating updated connection information and 
    start of data flow with new information
 
---
# Algo for extracting AVPs


The AVPs in RADIUS differ in lenght and location and type. Which is why
we have to loop through all the AVPs to get the ones required.

All the AVPs have three parts: 

1. Code
    - Unique Identifier for the Attribute
2. Length
    - the complete length of the AVP
3. Value
    - The data is signified in the next `lenght - 2` bytes.

The data bytes in RADIUS layer are read as follows:

```bash

    starting bytes: --- 28 06 00 00 00 02 --- 
    28 = dec(28) = 40 (Acct-Status-Type) 
    06 = total length 
    00 00 00 02 = value =  2 (stop) 
    bytes for data (4) are calculated  [total:6] - [bytesforlength:1] - [bytesforcode:1] = 4  
    
```

---
# Github Repo

Checkout the github Repo [here](https://github.com/IbrahimShahzad/CPacketParser)

