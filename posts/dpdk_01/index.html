<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
    










    







<script defer language="javascript" type="text/javascript" src="/js/bundle.min.38ccdf5c998a71d2ad889faefccbe9132577d265b25e73d94a1be540ebcaaa18.js"></script>






    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="icon" href=/favicon.png>

    
    





  





  
  
  


<!-- Open Graph image and Twitter Card metadata -->

  
<title itemprop="name">Ibrahim Shahzad - DPDK 01</title>
<meta property="og:title" content=Ibrahim&#32;Shahzad&#32;-&#32;DPDK&#32;01 />
<meta name="twitter:title" content=Ibrahim&#32;Shahzad&#32;-&#32;DPDK&#32;01 />
<meta itemprop="name" content=Ibrahim&#32;Shahzad&#32;-&#32;DPDK&#32;01 />
<meta name="application-name" content=Ibrahim&#32;Shahzad&#32;-&#32;DPDK&#32;01 />
<meta property="og:site_name" content="Ibrahim Shahzad - Personal Blog" />


<meta name="description" content="Setting up DPDK" />
<meta itemprop="description" content="Setting up DPDK" />
<meta property="og:description" content="Setting up DPDK" />
<meta name="twitter:description" content="Setting up DPDK" />


<base href="https://ibrahimshahzad.github.io/posts/dpdk_01/" />
<link rel="canonical" href="https://ibrahimshahzad.github.io/posts/dpdk_01/" itemprop="url" />
<meta name="url" content="https://ibrahimshahzad.github.io/posts/dpdk_01/" />
<meta name="twitter:url" content="https://ibrahimshahzad.github.io/posts/dpdk_01/" />
<meta property="og:url" content="https://ibrahimshahzad.github.io/posts/dpdk_01/" />


<meta property="og:updated_time" content="2021-06-13T00:00:00Z" />


<link rel="sitemap" type="application/xml" title="Sitemap" href='https://ibrahimshahzad.github.io/sitemap.xml' />

<meta name="robots" content="index,follow" />
<meta name="googlebot" content="index,follow" />



<meta property="fb:admins" content="" />


<meta name="apple-mobile-web-app-title" content="Ibrahim Shahzad - Personal Blog" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />






<meta name="generator" content="Hugo 0.92.2" />


    
    

<link type="text/css" rel="stylesheet" href="/css/bundle.min.94a339836f89f0d25f31980cb6b0631da21e20af128308747ce44e0525eb16ef.css">


    
    <style>
    body {
        --sidebar-bg-color: #202020;
        --sidebar-img-border-color: #515151;
        --sidebar-p-color: #909090;
        --sidebar-h1-color: #FFF;
        --sidebar-a-color: #FFF;
        --sidebar-socials-color: #FFF;
        --text-color: #222;
        --bkg-color: #FAF9F6;
        --post-title-color: #303030;
        --list-color: #5A5A5A;
        --link-color: #268BD2;
        --date-color: #515151;
        --table-border-color: #E5E5E5;
        --table-stripe-color: #F9F9F9;
        --code-color: #000;
        --code-background-color: #E5E5E5;
        --code-block-color: #FFF;
        --code-block-background-color: #272822;
        --moon-sun-color: #FFF;
        --moon-sun-background-color: #515151;
    }
    body.dark-theme {
        --text-color: #EEE;
        --bkg-color: #121212;
        --post-title-color: #DBE2E9;
        --list-color: #9D9D9D;
        --link-color: #268BD2;
        --date-color: #9A9A9A;
        --table-border-color: #515151;
        --table-stripe-color: #202020;
        --code-color: #FFF;
        --code-background-color: #515151;
        --code-block-color: #FFF;
        --code-block-background-color: #272822;
    }
    body {
        background-color: var(--bkg-color);
    }
</style>

</head>

    <body class="dark-theme">
        <div class="wrapper">
            <aside class="sidebar">
    <div class="container sidebar-sticky">
        <div class="light-dark" align="right">
    <button class="btn-light-dark" title="Toggle light/dark mode">
        <svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M6 .278a.768.768 0 0 1 .08.858a7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277c.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316a.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71C0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
        </svg>
        <svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M8 12a4 4 0 1 0 0-8a4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </svg>
    </button>
</div>

        <div class="sidebar-about">
    <h1 class="brand">
        
            <a href="https://ibrahimshahzad.github.io/">
                <img src="/images/profile.png" alt="brand image">
            </a>
        
        
            <a href="https://ibrahimshahzad.github.io/">
                <h1>Ibrahim Shahzad</h1>
            </a>
        
    </h1>
    <p class="lead">
    This is where i write sometimes...
    </p>
</div>

        <nav>
    <ul class="sidebar-nav">

        
        
        
        
            

            
                
                
            
            
                
                
            
                
                
            
        
        
            

            
                
                
                    <li class="heading">
                        <a href="/posts/">Posts</a>
                    </li>
                    
                        <li class="sub-heading">
                            Recent
                        </li>
                        
                            <li class="bullet">
                                <a href="https://ibrahimshahzad.github.io/posts/writing_lsp_for_kamailio_cfg_p1/">Writing LSP for kamailio_cfg p1</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="https://ibrahimshahzad.github.io/posts/parsing_kamailio_cfg/">Parsing_kamailio_cfg</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="https://ibrahimshahzad.github.io/posts/dpdk_03/">DPDK 03</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="https://ibrahimshahzad.github.io/posts/dpdk_02/">DPDK 02</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="https://ibrahimshahzad.github.io/posts/dpdk_01/">DPDK 01</a>
                            </li>
                        
                    
                
            
            
                
                
            
                
                
            
        

    </ul>
</nav>

        
    <a target="_blank" class="social" title="GitHub" href="https://github.com/IbrahimShahzad">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="-2 -2 24 24">
            <path fill="currentColor" d="M18.88 1.099C18.147.366 17.265 0 16.233 0H3.746C2.714 0 1.832.366 1.099 1.099C.366 1.832 0 2.714 0 3.746v12.487c0 1.032.366 1.914 1.099 2.647c.733.733 1.615 1.099 2.647 1.099H6.66c.19 0 .333-.007.429-.02a.504.504 0 0 0 .286-.169c.095-.1.143-.245.143-.435l-.007-.885c-.004-.564-.006-1.01-.006-1.34l-.3.052c-.19.035-.43.05-.721.046a5.555 5.555 0 0 1-.904-.091a2.026 2.026 0 0 1-.872-.39a1.651 1.651 0 0 1-.572-.8l-.13-.3a3.25 3.25 0 0 0-.41-.663c-.186-.243-.375-.407-.566-.494l-.09-.065a.956.956 0 0 1-.17-.156a.723.723 0 0 1-.117-.182c-.026-.061-.004-.111.065-.15c.07-.04.195-.059.378-.059l.26.04c.173.034.388.138.643.311a2.1 2.1 0 0 1 .631.677c.2.355.44.626.722.813c.282.186.566.28.852.28c.286 0 .533-.022.742-.065a2.59 2.59 0 0 0 .585-.196c.078-.58.29-1.028.637-1.34a8.907 8.907 0 0 1-1.333-.234a5.314 5.314 0 0 1-1.223-.507a3.5 3.5 0 0 1-1.047-.872c-.277-.347-.505-.802-.683-1.365c-.177-.564-.266-1.215-.266-1.952c0-1.049.342-1.942 1.027-2.68c-.32-.788-.29-1.673.091-2.652c.252-.079.625-.02 1.119.175c.494.195.856.362 1.086.5c.23.14.414.257.553.352a9.233 9.233 0 0 1 2.497-.338c.859 0 1.691.113 2.498.338l.494-.312a6.997 6.997 0 0 1 1.197-.572c.46-.174.81-.221 1.054-.143c.39.98.424 1.864.103 2.653c.685.737 1.028 1.63 1.028 2.68c0 .737-.089 1.39-.267 1.957c-.177.568-.407 1.023-.689 1.366a3.65 3.65 0 0 1-1.053.865c-.42.234-.828.403-1.223.507a8.9 8.9 0 0 1-1.333.235c.45.39.676 1.005.676 1.846v3.11c0 .147.021.266.065.357a.36.36 0 0 0 .208.189c.096.034.18.056.254.064c.074.01.18.013.318.013h2.914c1.032 0 1.914-.366 2.647-1.099c.732-.732 1.099-1.615 1.099-2.647V3.746c0-1.032-.367-1.914-1.1-2.647z"/>
        </svg>
    </a>



    <a target="_blank" class="social" title="LinkedIn" href="https://www.linkedin.com/in/mib93/">
        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 448 512">
            <path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5c0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7c-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5c67.2 0 79.7 44.3 79.7 101.9V416z"/>
        </svg>
    </a>















    <a target="_blank" class="social" title="RSS Feed" href="/posts/index.xml">
        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 1280.000000 1280.000000">
            <g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="currentColor">
                <path d="M2295 11929 c-284 -12 -642 -45 -707 -65 -17 -5 -18 -63 -18 -1039 0 -569 4 -1036 8 -1039 5 -3 74 6 153 19 510 86 1168 95 1789 25 1348 -153 2602 -677 3670 -1531 385 -308 820 -744 1126 -1129 842 -1060 1362 -2313 1514 -3650 70 -621 61 -1279 -25 -1789 -13 -79 -22 -148 -19 -153 3 -4 471 -8 1039 -8 l1035 0 5 23 c51 225 85 942 67 1419 -23 605 -77 1044 -198 1617 -294 1400 -927 2734 -1823 3846 -1043 1295 -2364 2259 -3909 2854 -1158 447 -2451 656 -3707 600z"/>
                <path d="M2255 7845 c-269 -25 -620 -81 -667 -106 -17 -9 -18 -55 -18 -899 0 -706 3 -890 13 -890 6 0 66 18 132 41 130 44 288 79 467 105 154 21 577 30 749 15 1207 -107 2267 -823 2814 -1902 166 -327 268 -637 330 -1001 38 -227 48 -384 42 -662 -8 -348 -44 -590 -126 -831 -23 -66 -41 -126 -41 -132 0 -10 184 -13 890 -13 844 0 890 1 899 18 27 50 88 452 110 725 14 162 14 624 1 782 -59 703 -233 1323 -545 1945 -481 956 -1313 1788 -2270 2268 -620 310 -1239 483 -1940 542 -165 14 -669 10 -840 -5z"/>
                <path d="M2519 3815 c-391 -66 -725 -336 -868 -703 -79 -201 -96 -462 -45 -677 83 -344 338 -641 666 -774 116 -47 205 -69 330 -80 412 -39 811 153 1040 500 193 292 240 648 128 981 -135 403 -492 699 -914 757 -100 14 -241 12 -337 -4z"/>
            </g>
        </svg>
    </a>





        <p class="footnote">
powered by <a target="_blank" href="https://gohugo.io">Hugo</a> | themed with <a target="_blank" href="https://github.com/lukeorth/poison">poison</a>
    <br>
    &copy; 2025 Ibrahim Shahzad - Personal Blog. All rights reserved.
</p>

  </div>
</aside>

            <main class="content container">
                <div class="post">
  <div class="info">
  <h1 class="post-title">
    <a href="https://ibrahimshahzad.github.io/posts/dpdk_01/">DPDK 01</a>
  </h1>

  <div class="headline">
    <div>
      
      
      <time datetime=" 2021-06-13T00:00:00Z" class="post-date">
        June 13, 2021
      </time>
      
      <span> - </span>
      <span class="reading-time">
        
          
        

        <span>5 mins read</span>
      </span>
    </div>

    
  </div>

  
  

  
</div>

  <h1 id="introduction">Introduction</h1>
<h2 id="what-is-dpdk">What is DPDK?</h2>
<p>Data Plane Development Kit (DPDK) is a set of libraries that enable fast packet processing.</p>
<h2 id="why-would-we-want-to-use-it">Why would we want to use it?</h2>
<p>If you are writing any application that deals with packets AND require fast
performance then you might need to look into fast packet processing libraries
such as DPDK.</p>
<p>In a normal flow the kernel receives a packet and does does its processing after
which it forwards the packet to the application in the userspace. Doing this few
each and every packet is quite costly in terms of performance.</p>
<p>With DPDK you bind the interface with the drivers provided, after which the
packet received can directly be accessed by the application  in userspace.</p>
<p>In short DPDK allows you to bypass the kernel and process the received packets
directly in user space.</p>
<p><em>DATAPATH</em> ususally entails 10s to 100s of Gigs per second on an interface. If you
want to write code dealing with such a traffic DPDK would be a fair choice.</p>
<h2 id="what-do-you-need">What Do you need?</h2>
<p>In order to follow along with the material you will need the following:</p>
<ul>
<li>
<p>A linux based system:</p>
<ul>
<li>
<p>2 Intel processors, each with 8 cores, 8 GB RAM</p>
</li>
<li>
<p><a href="http://core.dpdk.org/supported/" target="_blank"><!-- raw HTML omitted -->DPDK compatible NIC<!-- raw HTML omitted --></a></p>
</li>
</ul>
</li>
<li>
<p>Some knowledge of C</p>
</li>
</ul>
<p>Furthermore, for later you would also need to read up on following concepts:</p>
<ul>
<li>
<p>Enviroment Abstraction Layer</p>
</li>
<li>
<p>Hugepages</p>
</li>
<li>
<p>Non-Uniform Memory Architecture (NUMA)</p>
</li>
<li>
<p>Transition Lookaside Buffer (TLB)</p>
</li>
<li>
<p>CPU isolation and pinning</p>
</li>
</ul>
<p>Some Useful Links</p>
<ul>
<li>
<p><a href="http://doc.dpdk.org/guides/prog_guide/intro.html" target="_blank"><!-- raw HTML omitted -->Programmers Guide<!-- raw HTML omitted --></a></p>
</li>
<li>
<p><a href="http://doc.dpdk.org/api/" target="_blank"><!-- raw HTML omitted -->API Documentation<!-- raw HTML omitted --></a></p>
</li>
<li>
<p><a href="https://www.dpdk.org/" target="_blank"><!-- raw HTML omitted -->DPDK Home<!-- raw HTML omitted --></a></p>
</li>
</ul>
<hr>
<h1 id="lets-get-started">Lets Get Started</h1>
<h2 id="dpdk-installation">DPDK installation</h2>
<p>We will be using DPDK stable version 20.11.1. We would need to do A couple
things in this section</p>
<ol>
<li>
<p>Install the dependencies and Build DPDK</p>
</li>
<li>
<p>Set up some <code>Hugepages</code></p>
</li>
<li>
<p>Bind the NIC to the <code>igb_uio</code> dirver</p>
</li>
</ol>
<p>Fire up that ubuntu terminal and let us begin&hellip;</p>
<h3 id="installing-dependenciesdpdk">Installing dependencies/DPDK</h3>
<p>First lets install some dependencies</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo apt-get install -y build-essential <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>                        git <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>                        libnuma-dev <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>                        software-properties-common <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>                        python3 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>                        python3-pip <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>                        python3-pyelftools
</code></pre></div><p>Now that the dependencies have been taken care of lets get the DPDK tar file
and build it.</p>
<p>We will write a script that would help installing DPDK later as well. (i have
a habit of writing scripts XD)</p>
<p>open up a new file with your favourite editor (i hope its vim)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">vim install-dpdk.sh
</code></pre></div><p>Now paste the following in the file</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/bin/bash
</span><span style="color:#75715e"></span>pushd /opt/
wget https://fast.dpdk.org/rel/dpdk-20.11.1.tar.xz
tar xf dpdk-20.11.1.tar.xz
pushd dpdk-stable-20.11.1
pip3 install meson ninja
meson build
pushd build
ninja
ninja install
ldconfig
popd
popd
popd

</code></pre></div><p>The above code should do the following:</p>
<ol>
<li>
<p>get the <code>dpdk-20.11.1.tar.xz</code> file in <code>/opt/</code> directory</p>
</li>
<li>
<p>untar it</p>
</li>
<li>
<p>install <code>meson ninja</code></p>
</li>
<li>
<p>build the code</p>
</li>
<li>
<p>update the library path</p>
</li>
</ol>
<p>Make the file executable and run the script by following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">chmod u+x install-dpdk.sh
./install-dpdk.sh
</code></pre></div><h3 id="setting-up-hugepages">Setting up Hugepages</h3>
<p>There are two sizes of hugepages that we can set; <code>2M</code> or <code>1G</code>.</p>
<p>We can set it
the following way either by</p>
<ul>
<li>using the script in dpdk/usertools directory</li>
</ul>
<p><strong>OR</strong></p>
<ul>
<li>by setting them up in Grub file</li>
</ul>
<h4 id="usertools">Usertools</h4>
<ul>
<li>
<p>goto <code>/opt/dpdk-stable-20.11.1/usertools</code> where you will find
<code>dpdk-hugepages.py</code> python script</p>
</li>
<li>
<p>You can see the usage by running it with <code>-h</code> flag which should show you
following information</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">
        usage: dpdk-hugepages.py <span style="color:#f92672">[</span>-h<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--show<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--clear<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--mount<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--unmount<span style="color:#f92672">]</span> 
        <span style="color:#f92672">[</span>--node NODE<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--pagesize SIZE<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--reserve SIZE<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--setup SIZE<span style="color:#f92672">]</span>

        Setup huge pages

        optional arguments:
        -h, --help            show this help message and exit
        --show, -s            print the current huge page configuration
        --clear, -c           clear existing huge pages
        --mount, -m           mount the huge page filesystem
        --unmount, -u         unmount the system huge page directory
        --node NODE, -n NODE  <span style="color:#66d9ef">select</span> numa node to reserve pages on
        --pagesize SIZE, -p SIZE
                                choose huge page size to use
        --reserve SIZE, -r SIZE
                                reserve huge pages. Size is in bytes with K, M, or G suffix
        --setup SIZE          setup huge pages by doing clear, unmount, reserve and mount

        Examples:

        To display current huge page settings:
            dpdk-hugepages.py -s

        To a complete setup of with <span style="color:#ae81ff">2</span> Gigabyte of 1G huge pages:
            dpdk-hugepages.py -p 1G --setup 2G
</code></pre></div><ul>
<li>you can set up 4 hugepages with size of 1G each by running the following
command</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python3 dpdk-hugepages.py -p 1G --setup 4G
</code></pre></div><h4 id="grub-file">Grub file</h4>
<ul>
<li>We can set hugepages in the grub file as well. This would allow the machine to
set the pages up during boot time.
Run the following command</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sed -i -e <span style="color:#e6db74">&#39;s/GRUB_CMDLINE_LINUX=&#34;/GRUB_CMDLINE_LINUX=&#34;default_hugepagesz=1G hugepagesz=1G hugepages=4 iommu=pt intel_iommu=on isolcpu=0,1,2,3,4,5 /&#39;</span>  /etc/default/grub
</code></pre></div><p>The above command inserts a line in <code>/etc/deault/grub</code> file that:</p>
<ol>
<li>sets 4 hugepages with size <code>1G</code> each</li>
<li>isolates certain cpus from kernel scheduling so that we can dedicate those for our application.</li>
</ol>
<ul>
<li>Update the grub</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo update-grub
</code></pre></div><ul>
<li>Restart your machine</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo reboot
</code></pre></div><ul>
<li>you can check whether the <code>hugepages</code> are set up or not by running the
following:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat /proc/meminfo | grep -i <span style="color:#e6db74">&#34;huge&#34;</span>

        AnonHugePages:         <span style="color:#ae81ff">0</span> kB
        ShmemHugePages:        <span style="color:#ae81ff">0</span> kB
        FileHugePages:         <span style="color:#ae81ff">0</span> kB
        HugePages_Total:      <span style="color:#ae81ff">20</span>
        HugePages_Free:       <span style="color:#ae81ff">20</span>
        HugePages_Rsvd:        <span style="color:#ae81ff">0</span>
        HugePages_Surp:        <span style="color:#ae81ff">0</span>
        Hugepagesize:    <span style="color:#ae81ff">1048576</span> kB
        Hugetlb:        <span style="color:#ae81ff">20971520</span> kB

</code></pre></div><ul>
<li>Pay attention to <code>HugePages_Total</code>, <code>HugePages_Free</code> and <code>Hugepagesize</code> here.</li>
</ul>
<h3 id="installing-the-drivers">installing the drivers</h3>
<ul>
<li>Get the drivers</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo apt install dpdk-igb-uio-dkms -y
</code></pre></div><ul>
<li>load the driver</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo modprobe uio
</code></pre></div><h3 id="bind-the-nic-to-the-driver">bind the NIC to the driver</h3>
<ul>
<li>
<p>goto <code>/opt/dpdk-stable-20.11.1/usertools</code> where you will find
<code>dpdk-devbind.py</code> python script</p>
</li>
<li>
<p>run with <code>-s</code> flag that will show the staus of all the NICs</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python3 dpdk-devbind.py -s

        Network devices using kernel driver
        <span style="color:#f92672">===================================</span>
        0000:0b:00.0 <span style="color:#e6db74">&#39;example&#39;</span> <span style="color:#66d9ef">if</span><span style="color:#f92672">=</span>ens1 drv<span style="color:#f92672">=</span>i40e unused<span style="color:#f92672">=</span>vfio-pci,igb_uio *Active*
        0000:01:00.0 <span style="color:#e6db74">&#39;example&#39;</span> <span style="color:#66d9ef">if</span><span style="color:#f92672">=</span>ens2 drv<span style="color:#f92672">=</span>i40e unused<span style="color:#f92672">=</span>vfio-pci,igb_uio
        0000:01:00.1 <span style="color:#e6db74">&#39;example&#39;</span> <span style="color:#66d9ef">if</span><span style="color:#f92672">=</span>ens3 drv<span style="color:#f92672">=</span>i40e unused<span style="color:#f92672">=</span>vfio-pci,igb_uio
        0000:01:00.2 <span style="color:#e6db74">&#39;example&#39;</span> <span style="color:#66d9ef">if</span><span style="color:#f92672">=</span>ens4 drv<span style="color:#f92672">=</span>i40e unused<span style="color:#f92672">=</span>vfio-pci,igb_uio
        0000:01:00.3 <span style="color:#e6db74">&#39;example&#39;</span> <span style="color:#66d9ef">if</span><span style="color:#f92672">=</span>ens5 drv<span style="color:#f92672">=</span>i40e unused<span style="color:#f92672">=</span>vfio-pci,igb_uio

</code></pre></div><ul>
<li>we can bind the desired NIC to the <code>igb_uio</code> driver using its PCI address as
follows</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python3 ./dpdk-devbind.py -b igb_uio 0000:01:00.0
</code></pre></div><p>This should change the status as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python3 dpdk-devbind.py -s

        Network devices using DPDK compatible driver
        <span style="color:#f92672">===================================</span>
        0000:01:00.0 <span style="color:#e6db74">&#39;example&#39;</span> <span style="color:#66d9ef">if</span><span style="color:#f92672">=</span>ens2 drv<span style="color:#f92672">=</span>igb_uio unused<span style="color:#f92672">=</span>i40e,vfio-pci

        Network devices using kernel driver
        <span style="color:#f92672">===================================</span>
        0000:0b:00.0 <span style="color:#e6db74">&#39;example&#39;</span> <span style="color:#66d9ef">if</span><span style="color:#f92672">=</span>ens1 drv<span style="color:#f92672">=</span>i40e unused<span style="color:#f92672">=</span>vfio-pci,igb_uio *Active*
        0000:01:00.1 <span style="color:#e6db74">&#39;example&#39;</span> <span style="color:#66d9ef">if</span><span style="color:#f92672">=</span>ens3 drv<span style="color:#f92672">=</span>i40e unused<span style="color:#f92672">=</span>vfio-pci,igb_uio
        0000:01:00.2 <span style="color:#e6db74">&#39;example&#39;</span> <span style="color:#66d9ef">if</span><span style="color:#f92672">=</span>ens4 drv<span style="color:#f92672">=</span>i40e unused<span style="color:#f92672">=</span>vfio-pci,igb_uio
        0000:01:00.3 <span style="color:#e6db74">&#39;example&#39;</span> <span style="color:#66d9ef">if</span><span style="color:#f92672">=</span>ens5 drv<span style="color:#f92672">=</span>i40e unused<span style="color:#f92672">=</span>vfio-pci,igb_uio

</code></pre></div><hr>
<h1 id="all-done">ALL Done</h1>
<p><img src="https://i.pinimg.com/originals/59/54/b4/5954b408c66525ad932faa693a647e3f.jpg" alt="phew"></p>
<ul>
<li>
<p>We have finally set up the <strong>DPDK</strong>.</p>
</li>
<li>
<p>In the next one we will <em>write C code to receive and transmit the packets
using DPDK</em>.</p>
</li>
<li>
<p>In the meanwhile go to <code>/opt/dpdk-stable-20.11.1/examples</code> where you will
find a lot of example code. I would suggest to try the <code>helloworld</code> and
<code>l2fwd</code>.</p>
</li>
<li>
<p>you cand read about <strong><em>L2FWD</em></strong> <a href="https://doc.dpdk.org/guides/sample_app_ug/l2_forward_real_virtual.html" target="_blank"><!-- raw HTML omitted -->here<!-- raw HTML omitted --></a></p>
</li>
</ul>

  
  <hr>
<div class="footer">
    
	    
            <a class="previous-post" href="https://ibrahimshahzad.github.io/posts/getting_started_with_vim/?ref=footer"><span style="font-weight:bold;">« Previous</span><br>Set up your vim</a>
        
	    
            <div class="next-post">
                <a href="https://ibrahimshahzad.github.io/posts/dpdk_02/?ref=footer"><span style="font-weight:bold;">Next »</span><br>DPDK 02</a>
            </div>
        
    
</div>

  
</div>
            </main>
            
  
    <div class="article-toc ">
    <div class="toc-wrapper">
      <h4 id="contents"></h4>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#what-is-dpdk">What is DPDK?</a></li>
    <li><a href="#why-would-we-want-to-use-it">Why would we want to use it?</a></li>
    <li><a href="#what-do-you-need">What Do you need?</a></li>
  </ul>

  <ul>
    <li><a href="#dpdk-installation">DPDK installation</a>
      <ul>
        <li><a href="#installing-dependenciesdpdk">Installing dependencies/DPDK</a></li>
        <li><a href="#setting-up-hugepages">Setting up Hugepages</a></li>
        <li><a href="#installing-the-drivers">installing the drivers</a></li>
        <li><a href="#bind-the-nic-to-the-driver">bind the NIC to the driver</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

  

        </div>
    </body>
</html>
